# 02 架构设计师 系统蓝图

更新时间：2026-02-17
Owner：架构设计师

## 1. 目标架构原则

- 真：只输出真实岗位或明确空结果
- 稳：任一外部源故障不拖垮主流程
- 快：核心链路可降级，用户可感知进度
- 可观测：每一步有事件和指标

## 2. 逻辑架构

- Web 层：`web_app.py`（页面 + API）
- 核心流程：`/api/process` + market pipeline
- 岗位数据层：provider 适配器（openclaw / baidu / bing / enterprise / cache）
- 质量层：输出质量门禁 + 契约校验
- 数据层：SQLite 事件与反馈

## 3. 关键接口契约

- `POST /api/process`
  - 输入：`resume`
  - 输出：`schema_version`, `recommended_jobs`, `quality_gate` 等
- `GET /api/jobs/search`
  - 支持 `allow_portal_fallback` 开关
- `POST /api/business/event`
  - 接收前端增长事件

## 4. 关键技术决策

- 默认禁用“搜索入口回退”防止伪真实
- 允许配置开关，仅在明确需要时启用入口兜底
- 引入 `process_response.v2` 统一结构化输出
- 引入输出质量门禁，拦截跑偏文本

## 5. 当前技术债

- 单体 `web_app.py` 过大，需拆分 service/router
- provider 可靠性评分体系不完善
- 暂无缓存热身策略和多源并发融合

## 6. 下一阶段架构任务

- 拆分 API 路由层（process/jobs/business/admin）
- 增加 provider 健康权重路由
- 引入岗位新鲜度与去重指纹索引
- 增加失败重试与熔断（外部源）

## 7. 风险控制

- 外部源不可控 -> 配置优先级 + 超时 + 回退策略
- 输出失真 -> 质量门禁 + 审计事件
- 发布风险 -> 灰度发布 + 一键回滚
